{% extends "base.html" %}

{% block title %}Schedule - Artframe{% endblock %}

{% block content %}
<div class="schedule-page">
    <!-- Header -->
    <div class="page-header">
        <div>
            <h2>üìÖ Content Schedule</h2>
            <p class="subtitle">Plan every minute of your display</p>
        </div>
        <button class="btn btn-primary btn-large" onclick="openCreateEntryModal()">
            ‚ûï Add Schedule Entry
        </button>
    </div>

    <!-- Current Display Status -->
    <div id="current-status-banner" class="current-status-banner">
        <div class="status-content">
            <div class="status-icon">‚è±Ô∏è</div>
            <div class="status-info">
                <div class="status-label">Currently Displaying</div>
                <div id="current-status-text" class="status-text">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Weekly Schedule Grid - HERO FEATURE -->
    <div class="weekly-schedule-card">
        <div class="card-header">
            <h3>üìä Weekly Schedule</h3>
            <div class="view-controls">
                <select id="view-mode" onchange="changeViewMode(this.value)">
                    <option value="week">Week View</option>
                    <option value="day">Day View</option>
                </select>
            </div>
        </div>

        <!-- Week View -->
        <div id="week-view" class="week-view">
            <div id="weekly-grid-container" class="weekly-grid-container">
                <p class="loading">Loading schedule...</p>
            </div>
        </div>

        <!-- Day View (Single Day Detailed) -->
        <div id="day-view" class="day-view" style="display: none;">
            <div class="day-tabs">
                <button class="day-tab" onclick="changeDay(0)">Monday</button>
                <button class="day-tab" onclick="changeDay(1)">Tuesday</button>
                <button class="day-tab" onclick="changeDay(2)">Wednesday</button>
                <button class="day-tab" onclick="changeDay(3)">Thursday</button>
                <button class="day-tab" onclick="changeDay(4)">Friday</button>
                <button class="day-tab" onclick="changeDay(5)">Saturday</button>
                <button class="day-tab" onclick="changeDay(6)">Sunday</button>
            </div>
            <div id="single-day-timeline" class="single-day-timeline">
                <p class="loading">Loading timeline...</p>
            </div>
        </div>

        <!-- Legend -->
        <div id="schedule-legend" class="schedule-legend">
            <!-- Will be populated by JS -->
        </div>
    </div>

    <!-- Settings Row -->
    <div class="settings-row">
        <!-- Default Content -->
        <div class="settings-card">
            <h4>üé® Default Content</h4>
            <p class="hint">Shown when nothing is scheduled</p>
            <select id="default-instance-select" onchange="saveDefaultContent()">
                <option value="">None (keep last displayed)</option>
            </select>
        </div>

        <!-- Quick Stats -->
        <div class="settings-card">
            <h4>üìà Schedule Stats</h4>
            <div id="schedule-stats" class="stats-grid">
                <div class="stat">
                    <div class="stat-value" id="stat-entries">0</div>
                    <div class="stat-label">Entries</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="stat-coverage">0%</div>
                    <div class="stat-label">Coverage</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Entries List -->
    <div class="entries-card">
        <div class="card-header">
            <h3>üìù All Schedule Entries</h3>
            <button class="btn btn-secondary btn-small" onclick="openCreateEntryModal()">
                ‚ûï Add Entry
            </button>
        </div>
        <div id="entries-list">
            <p class="loading">Loading entries...</p>
        </div>
    </div>
</div>

<!-- Create/Edit Schedule Entry Modal -->
<div id="entry-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="entry-modal-title">Add Schedule Entry</h3>
            <button class="modal-close" onclick="closeEntryModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="entry-form" onsubmit="saveEntry(event)">
                <input type="hidden" id="entry-id">

                <div class="form-group">
                    <label for="entry-name">Name</label>
                    <input type="text" id="entry-name" required placeholder="e.g., Morning Clock">
                    <small>Give this schedule entry a descriptive name</small>
                </div>

                <div class="form-group">
                    <label for="entry-instance">Plugin Instance</label>
                    <select id="entry-instance" required>
                        <option value="">Select a plugin instance...</option>
                    </select>
                    <small>What content to display during this time</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="entry-start-time">Start Time</label>
                        <input type="time" id="entry-start-time" required>
                    </div>

                    <div class="form-group">
                        <label for="entry-end-time">End Time</label>
                        <input type="time" id="entry-end-time" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Days of Week</label>
                    <div class="days-checkboxes">
                        <label><input type="checkbox" value="0" class="day-checkbox"> Monday</label>
                        <label><input type="checkbox" value="1" class="day-checkbox"> Tuesday</label>
                        <label><input type="checkbox" value="2" class="day-checkbox"> Wednesday</label>
                        <label><input type="checkbox" value="3" class="day-checkbox"> Thursday</label>
                        <label><input type="checkbox" value="4" class="day-checkbox"> Friday</label>
                        <label><input type="checkbox" value="5" class="day-checkbox"> Saturday</label>
                        <label><input type="checkbox" value="6" class="day-checkbox"> Sunday</label>
                    </div>
                    <small>Select which days this schedule should apply</small>
                </div>

                <div class="form-group">
                    <label for="entry-priority">Priority</label>
                    <input type="number" id="entry-priority" value="5" min="1" max="10" required>
                    <small>Higher number = higher priority if schedules overlap (1-10)</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEntryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Entry</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .schedule-page {
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #f0f0f0;
    }

    .page-header h2 {
        margin: 0;
        font-size: 32px;
        color: #333;
    }

    .page-header .subtitle {
        margin: 4px 0 0 0;
        font-size: 16px;
        color: #666;
    }

    .btn-large {
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 600;
    }

    /* Current Status Banner */
    .current-status-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 32px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .status-content {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .status-icon {
        font-size: 48px;
        opacity: 0.9;
    }

    .status-label {
        font-size: 13px;
        opacity: 0.85;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
    }

    .status-text {
        font-size: 24px;
        font-weight: 700;
    }

    /* Timeline Visualizer */
    .day-selector {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .day-selector button {
        flex: 1;
        min-width: 100px;
    }

    .day-selector button.active {
        background: #667eea;
        color: white;
    }

    .timeline-container {
        background: #f9f9f9;
        border-radius: 8px;
        padding: 20px;
        min-height: 200px;
    }

    .timeline {
        position: relative;
        height: 60px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 20px;
    }

    .timeline-block {
        position: absolute;
        height: 100%;
        border-radius: 4px;
        padding: 8px;
        font-size: 12px;
        color: white;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        cursor: pointer;
        transition: transform 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .timeline-block:hover {
        transform: scale(1.02);
        z-index: 10;
    }

    .timeline-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 12px;
        color: #666;
    }

    .timeline-legend {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
    }

    .legend-item {
        display: inline-block;
        margin-right: 15px;
        margin-bottom: 8px;
    }

    .legend-color {
        display: inline-block;
        width: 20px;
        height: 12px;
        border-radius: 2px;
        margin-right: 6px;
        vertical-align: middle;
    }

    /* Default Content */
    .default-content-form select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    /* Entries Table */
    .entries-table {
        width: 100%;
        border-collapse: collapse;
    }

    .entries-table th,
    .entries-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }

    .entries-table th {
        background: #f9f9f9;
        font-weight: 600;
        color: #333;
    }

    .entries-table tr:hover {
        background: #f9f9f9;
    }

    .entry-actions {
        display: flex;
        gap: 8px;
    }

    .entry-actions button {
        padding: 6px 12px;
        font-size: 12px;
    }

    .days-badge {
        display: inline-block;
        padding: 2px 6px;
        background: #f0f0f0;
        border-radius: 3px;
        font-size: 11px;
        margin-right: 4px;
    }

    .priority-badge {
        display: inline-block;
        padding: 4px 8px;
        background: #4CAF50;
        color: white;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
    }

    /* Form Styling */
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .days-checkboxes {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 4px;
    }

    .days-checkboxes label {
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .days-checkboxes input[type="checkbox"] {
        margin-right: 8px;
        cursor: pointer;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
    }

    .empty-state h3 {
        color: #666;
        margin-bottom: 10px;
    }

    /* Weekly Schedule Card - HERO FEATURE */
    .weekly-schedule-card {
        background: white;
        border-radius: 12px;
        padding: 28px;
        margin-bottom: 32px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border: 1px solid #e8e8e8;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .card-header h3 {
        margin: 0;
        font-size: 20px;
        color: #333;
    }

    .view-controls select {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        cursor: pointer;
    }

    /* Weekly Grid View */
    .weekly-grid-container {
        overflow-x: auto;
    }

    .weekly-grid {
        display: grid;
        grid-template-columns: 80px repeat(24, 1fr);
        gap: 1px;
        background: #e0e0e0;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        min-width: 1200px;
    }

    .grid-cell {
        background: white;
        padding: 12px 8px;
        text-align: center;
        font-size: 13px;
    }

    .grid-header {
        background: #f5f5f5;
        font-weight: 600;
        color: #555;
        font-size: 11px;
    }

    .grid-day-label {
        background: #f5f5f5;
        font-weight: 600;
        color: #333;
        text-align: left;
        padding-left: 16px;
    }

    .grid-content-cell {
        padding: 4px;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 500;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .grid-content-cell:hover {
        transform: scale(1.05);
        z-index: 10;
    }

    .grid-content-cell.has-content {
        color: white;
    }

    .grid-content-cell.default {
        background: #f0f0f0;
        color: #999;
        font-style: italic;
    }

    /* Day Tabs */
    .day-tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }

    .day-tab {
        padding: 12px 20px;
        border: none;
        background: transparent;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #666;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
    }

    .day-tab:hover {
        color: #333;
        background: #f9f9f9;
    }

    .day-tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
    }

    /* Single Day Timeline */
    .single-day-timeline {
        padding: 20px;
        background: #f9f9f9;
        border-radius: 8px;
    }

    /* Schedule Legend */
    .schedule-legend {
        margin-top: 24px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
    }

    .schedule-legend h4 {
        margin: 0 0 12px 0;
        font-size: 14px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .legend-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
    }

    /* Settings Row */
    .settings-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 32px;
    }

    .settings-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border: 1px solid #e8e8e8;
    }

    .settings-card h4 {
        margin: 0 0 8px 0;
        font-size: 18px;
        color: #333;
    }

    .settings-card .hint {
        margin: 0 0 16px 0;
        font-size: 13px;
        color: #999;
    }

    .settings-card select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        background: white;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .stat {
        text-align: center;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 12px;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Entries Card */
    .entries-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border: 1px solid #e8e8e8;
        margin-bottom: 40px;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .modal-large .modal-content {
        max-width: 800px;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 24px;
        border-bottom: 2px solid #f0f0f0;
    }

    .modal-header h3 {
        margin: 0;
        font-size: 22px;
        color: #333;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 32px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
    }

    .modal-close:hover {
        color: #333;
    }

    .modal-body {
        padding: 24px;
    }

    .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 20px;
        border-top: 1px solid #f0f0f0;
    }

    /* Form Styles */
    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
    }

    .form-group input[type="text"],
    .form-group input[type="time"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="time"]:focus,
    .form-group input[type="number"]:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group small {
        display: block;
        margin-top: 6px;
        font-size: 12px;
        color: #999;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .days-checkboxes {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 12px;
        background: #f9f9f9;
        border-radius: 6px;
    }

    .days-checkboxes label {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-weight: normal;
        color: #555;
    }

    .days-checkboxes input[type="checkbox"] {
        margin-right: 10px;
        cursor: pointer;
        width: 18px;
        height: 18px;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/schedule.js') }}"></script>
{% endblock %}
